# ARK Broker chart values

# Global annotations added to all resources
global:
  annotations:
    ark.mckinsey.com/service: ark-broker

# Application configuration
app:
  name: ark-broker
  image:
    repository: ghcr.io/mckinsey/agents-at-scale-ark/ark-broker
    # tag defaults to .Chart.AppVersion if not specified
    pullPolicy: IfNotPresent
  
  # Resource configuration
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "1024Mi"
      cpu: "1000m"

replicaCount: 1

service:
  type: ClusterIP
  port: 80

# Memory service configuration
memory:
  # Create a Memory CRD resource
  createMemoryCRD: true
  # Set this Memory as the default (names it "default")
  setAsDefault: false
  # Port for the HTTP server
  port: 8080
  # Maximum message size in bytes (10MB)
  maxMessageSize: 10485760
  # Maximum number of messages/chunks to keep (0 = unlimited)
  # Defaults to 50000 messages to prevent unbounded growth while staying well within the 1GB memory limit
  maxMemoryDb: 50000
  # Maximum age of items in seconds (0 = no age limit)
  # Examples: 86400 = 1 day, 604800 = 7 days, 2592000 = 30 days
  maxItemAge: 0

# Streaming configuration
streaming:
  # Enable streaming support via ConfigMap (creates 'ark-config-streaming' when enabled)
  enabled: true

# Persistence configuration
persistence:
  enabled: false
  # Storage class for the PVC (uses default if not specified)
  storageClass: ""
  # Access mode for the PVC
  accessMode: ReadWriteOnce
  # Size of the persistent volume
  size: 1Gi
  # Path where memory data will be stored
  mountPath: /data
  # Filename for the memory data
  memoryFileName: memory.json
  # Filename for the stream data
  streamFileName: stream.json
  # Use existing PVC instead of creating a new one
  existingClaim: ""

serviceAccount:
  create: true
  name: ""

podSecurityContext: {}

securityContext: {}

nodeSelector: {}

tolerations: []

affinity: {}

# OTEL endpoint configuration - registers this broker as an OTEL trace receiver
# When enabled, creates a ConfigMap that the ARK controller discovers when processing queries
otelEndpoint:
  enabled: true
