# CVE-2026-0994: Protobuf Recursion Depth Bypass

**Status:** VULNERABLE (No patch available as of 2026-01-26)

## Vulnerability Details

- **CVE:** CVE-2026-0994
- **Component:** Python `google.protobuf`
- **Severity:** High (CVSS 8.2)
- **Vulnerable Versions:** All versions ≤ 6.33.4
- **Patched Version:** Not yet released (fix merged to master but not published to PyPI)

## Description

A denial-of-service (DoS) vulnerability exists in `google.protobuf.json_format.ParseDict()` where the `max_recursion_depth` limit can be bypassed when parsing nested `google.protobuf.Any` messages. The vulnerability allows an attacker to supply deeply nested Any structures that bypass the intended recursion limit, eventually exhausting Python's recursion stack and causing a `RecursionError`.

## Affected Ark Components

1. **services/ark-api/ark-api**
   - Uses: `a2a-sdk>=0.2.12` (depends on protobuf)
   - Current version: protobuf 6.33.4 (vulnerable)

2. **samples/a2a/langchain-weather-agent**
   - Uses: `a2a-sdk[http-server]>=0.2.6` (depends on protobuf)
   - Updated: protobuf 6.33.0 → 6.33.4 (still vulnerable but latest available)

## Current Mitigation

Since no patched version is available yet:

1. **Version pinning:** Explicitly pinned to `protobuf>=6.33.4` in pyproject.toml files
2. **Ready for upgrade:** When patched version is released, run:
   ```bash
   cd services/ark-api/ark-api && uv lock --upgrade-package protobuf
   cd samples/a2a/langchain-weather-agent && uv lock --upgrade-package protobuf
   ```

## Risk Assessment

- **Attack Vector:** Requires attacker-controlled input to `json_format.ParseDict()` with nested Any messages
- **Impact:** Denial-of-service (Python process crash)
- **Exploitability:** Moderate (requires specific input conditions)
- **Data Risk:** None (DoS only, no data exfiltration)

## Workarounds

Until a patch is available:

1. **Avoid untrusted input:** Don't parse JSON from untrusted sources using `json_format.ParseDict()`
2. **Input validation:** Validate and sanitize JSON before passing to protobuf parsers
3. **Rate limiting:** Implement rate limiting on endpoints that accept protobuf JSON input

## References

- [CVE-2026-0994 Details](https://www.cvedetails.com/cve/CVE-2026-0994/)
- [GitHub Fix PR #25239](https://github.com/protocolbuffers/protobuf/pull/25239)
- [Snyk Advisory](https://security.snyk.io/vuln/SNYK-PYTHON-PROTOBUF-15090738)
- [GitLab Advisory](https://advisories.gitlab.com/pkg/pypi/protobuf/CVE-2026-0994/)
- [DEV Community Analysis](https://dev.to/cverports/cve-2026-0994-recursive-hell-breaking-python-protobuf-with-nested-any-messages-36fj)

## Action Items

- [x] Pin protobuf to >=6.33.4 in affected services
- [x] Update langchain-weather-agent from 6.33.0 to 6.33.4
- [ ] Monitor protobuf releases for patched version
- [ ] Update to patched version when available
- [ ] Review A2A SDK usage for json_format.ParseDict() calls
